<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Department.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">project</a> &gt; <a href="index.source.html" class="el_package">edu.odu.cs.cs350.pne</a> &gt; <span class="el_source">Department.java</span></div><h1>Department.java</h1><pre class="source lang-java linenums">package edu.odu.cs.cs350.pne;

import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.FileWriter;
import java.util.Scanner;

import org.apache.poi.hssf.usermodel.HSSFWorkbook;
import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.usermodel.Workbook;

import java.io.IOException;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Random;

<span class="nc" id="L20">public class Department {</span>
    public static void main(String[] args) throws IOException {
<span class="nc bnc" id="L22" title="All 2 branches missed.">        if (args.length == 0) {</span>
<span class="nc" id="L23">            System.err.println(&quot;Usage: java CsvReader &lt;directory&gt;&quot;);</span>
<span class="nc" id="L24">            System.exit(1);</span>
        }

        // creates semesters and assigns information for each semester directory given
        // in args[] in the command line
<span class="nc" id="L29">        ArrayList&lt;Semester&gt; semesterList = new ArrayList&lt;Semester&gt;();</span>
<span class="nc bnc" id="L30" title="All 2 branches missed.">        for (int i = 0; i &lt; args.length - 1; i++) {</span>
            // Initializing semester for semester Directory at args[i]
<span class="nc" id="L32">            Semester tempSemester = new Semester();</span>
<span class="nc" id="L33">            tempSemester.setSeason(args[i].substring(args[i].length() - 2, args[i].length()));</span>
<span class="nc" id="L34">            tempSemester.setYear(args[i].substring(args[i].length() - 6, args[i].length() - 2));</span>

            // Reads Data In
<span class="nc" id="L37">            readCsvFiles(args[i], tempSemester);</span>

<span class="nc" id="L39">            semesterList.add(tempSemester);</span>
        }

<span class="nc" id="L42">        Semester mergedSemesters = mergeSemesters(semesterList);</span>
<span class="nc" id="L43">        String lArg = args[args.length - 1];</span>

<span class="nc" id="L45">        ProjectionReports(mergedSemesters, lArg, semesterList);</span>
<span class="nc" id="L46">    }</span>

    public static void readCsvFiles(String directory, Semester tempSemester) {

<span class="nc" id="L50">        String start = null;</span>
<span class="nc" id="L51">        String end = null;</span>

        // Directory check : ensures directory exist
<span class="nc" id="L54">        File dir = new File(directory);</span>
<span class="nc bnc" id="L55" title="All 2 branches missed.">        if (!dir.isDirectory()) {</span>
<span class="nc" id="L56">            System.err.println(&quot;Error: &quot; + directory + &quot; is not a directory.&quot;);</span>
<span class="nc" id="L57">            System.exit(-1);</span>
        }

<span class="nc" id="L60">        File[] dates = dir.listFiles((dir1, name) -&gt; name.endsWith(&quot;.txt&quot;));</span>
<span class="nc bnc" id="L61" title="All 2 branches missed.">        for (File date : dates) {</span>
            try{
<span class="nc" id="L63">            Scanner scanner = new Scanner(date);</span>
<span class="nc" id="L64">              start =scanner.nextLine();</span>
<span class="nc" id="L65">              end =scanner.nextLine();</span>
            
<span class="nc" id="L67">              scanner.close();</span>
<span class="nc" id="L68">            }catch (FileNotFoundException e) {</span>
<span class="nc" id="L69">                System.err.println(&quot;Error: File not found - &quot; + date.getName());</span>
<span class="nc" id="L70">                System.exit(1);</span>
<span class="nc" id="L71">            }</span>
        }
        
<span class="nc" id="L74">        Calendar sDate = Calendar.getInstance();</span>
<span class="nc" id="L75">        Calendar eDate= Calendar.getInstance();</span>
<span class="nc" id="L76">        Calendar fDate= Calendar.getInstance();</span>

<span class="nc" id="L78">        sDate.set(Integer.parseInt(start.substring(0, 4)), Integer.parseInt(start.substring(5, 7)), Integer.parseInt(start.substring(8, 10)));</span>
<span class="nc" id="L79">        eDate.set(Integer.parseInt(end.substring(0, 4)), Integer.parseInt(end.substring(5, 7)), Integer.parseInt(end.substring(8, 10)));</span>

<span class="nc" id="L81">        File[] files = dir.listFiles((dir1, name) -&gt; name.endsWith(&quot;.csv&quot;));</span>

<span class="nc bnc" id="L83" title="All 2 branches missed.">        for (File file : files) {</span>
            try {

<span class="nc" id="L86">                fDate.set(Integer.parseInt(file.getName().substring(0, 4)), Integer.parseInt(file.getName().substring(5, 7)), Integer.parseInt(file.getName().substring(8, 10)));</span>
          
<span class="nc bnc" id="L88" title="All 4 branches missed.">                   if(fDate.compareTo(sDate)&gt;=0 &amp;&amp;fDate.compareTo(eDate)&lt;=0)</span>
                       {            
<span class="nc" id="L90">                                Snapshot tempSnapshot = new Snapshot();</span>
<span class="nc" id="L91">                                Scanner scanner = new Scanner(file);</span>
                
<span class="nc" id="L93">                                scanner.nextLine();</span>
<span class="nc" id="L94">                                tempSnapshot.setFileName(file.getName());</span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">                                while (scanner.hasNextLine()) {</span>
<span class="nc" id="L96">                                    String line = scanner.nextLine();</span>
<span class="nc" id="L97">                                    line = line.trim();</span>
                
<span class="nc" id="L99">                                    String[] fields = line.split(&quot;\&quot;,\&quot;&quot;);</span>
                                    // Read each line of data and stored needed data
<span class="nc" id="L101">                                    tempSnapshot = readCSVLine(fields, tempSnapshot);</span>
<span class="nc" id="L102">                                }</span>
<span class="nc" id="L103">                                tempSemester.addSnapshot(tempSnapshot);</span>
<span class="nc" id="L104">                                scanner.close();</span>
                        } 
                    }
<span class="nc" id="L107">           catch (FileNotFoundException e) {</span>
<span class="nc" id="L108">            System.err.println(&quot;Error: File not found - &quot; + file.getName());</span>
<span class="nc" id="L109">            System.exit(1);</span>
<span class="nc" id="L110">            }  </span>
        }
<span class="nc" id="L112">    }</span>

    // Reads each line of data and stored needed data
    // Reads a given line from a CSV file sends it to the apporitate location
    public static Snapshot readCSVLine(String[] fields, Snapshot tempSnapshot) {
<span class="nc" id="L117">        Course tempCourse = new Course();</span>
<span class="nc" id="L118">        Offering tempOffering = new Offering();</span>
<span class="nc" id="L119">        Enrollment tempEnrollment = new Enrollment();</span>
<span class="nc" id="L120">        Section tempSection = new Section();</span>

        // Adds course data to tempCourse
<span class="nc" id="L123">        tempCourse.setCRSE(fields[3]);</span>
<span class="nc" id="L124">        tempCourse.setSubject(fields[2]);</span>

        // Adds Section data to tempSection
<span class="nc bnc" id="L127" title="All 2 branches missed.">        if (fields[8].length() != 0) {</span>
<span class="nc" id="L128">            tempSection.setLINK(fields[8].substring(1, 2));</span>
        } else {
<span class="nc" id="L130">            tempSection.setLINK(&quot;1&quot;);</span>
        }
        // Adds Offering data to tempOffering
<span class="nc" id="L133">        tempOffering.setProfessor(fields[21]);</span>
<span class="nc" id="L134">        tempOffering.setCRN(Integer.parseInt(fields[1]));</span>
<span class="nc" id="L135">        tempOffering.setNumSections(3);</span>

        // Adds enrollment data to tempEnrollment
<span class="nc" id="L138">        tempEnrollment.setXLSTCap(Integer.parseInt(fields[6]));</span>
<span class="nc" id="L139">        tempEnrollment.setENR(Integer.parseInt(fields[7]));</span>
<span class="nc" id="L140">        tempEnrollment.setXLSTGroup(fields[9]);</span>
<span class="nc" id="L141">        tempEnrollment.setOVERALLCAP(Integer.parseInt(fields[23]));</span>
<span class="nc" id="L142">        tempEnrollment.setXLSTENR(Integer.parseInt(fields[24]));</span>

        // Adds tempEnrollment to tempOffering
<span class="nc" id="L145">        tempOffering.setEnrollment(tempEnrollment);</span>

        // If the course exists in the list of courses check to see if the section exist
        // in the list of sections
<span class="nc bnc" id="L149" title="All 2 branches missed.">        if (tempSnapshot.getCourse(fields[3]) != null) {</span>

            // If section already exist in the array of section just add the offering to the
            // existing sections's array of offerings
<span class="nc bnc" id="L153" title="All 2 branches missed.">            if (tempSnapshot.getCourse(fields[3]).getSection(tempSection.getLink()) != null) {</span>

<span class="nc" id="L155">                tempSnapshot.getCourse(fields[3]).getSection(tempSection.getLink()).addOffering(tempOffering);</span>
            }
            // If section doesn't already exist in the section array, create new section in
            // the array of section, and add tempOffering to that course
            else {
<span class="nc" id="L160">                tempSection.addOffering(tempOffering);</span>
<span class="nc" id="L161">                tempSnapshot.getCourse(fields[3]).addSection(tempSection);</span>
            }

        }
        // If course doesn't already exist in the course array, add tempOffering to the
        // tempSection,
        // add tempSection to that courseList , add temp section to new course in the
        // array of courses
        else {
<span class="nc" id="L170">            tempSection.addOffering(tempOffering);</span>
<span class="nc" id="L171">            tempCourse.addSection(tempSection);</span>
<span class="nc" id="L172">            tempSnapshot.addCourse(tempCourse);</span>
        }
<span class="nc" id="L174">        return tempSnapshot;</span>
    }

    public static int[] smoothCurve(int[] values) {
<span class="fc" id="L178">        int[] smoothedValues = new int[values.length];</span>
<span class="fc" id="L179">        int windowSize = (int) Math.ceil((double) values.length / 10); // dynamic window size</span>

<span class="fc bfc" id="L181" title="All 2 branches covered.">        for (int i = 0; i &lt; values.length; i++) {</span>
<span class="fc" id="L182">            int sum = 0;</span>
<span class="fc" id="L183">            int count = 0;</span>
<span class="fc bfc" id="L184" title="All 2 branches covered.">            for (int j = Math.max(0, i - windowSize); j &lt;= Math.min(values.length - 1, i + windowSize); j++) {</span>
<span class="fc" id="L185">                sum += values[j];</span>
<span class="fc" id="L186">                count++;</span>
            }

<span class="fc" id="L189">            smoothedValues[i] = (sum / count);</span>
        }

<span class="fc" id="L192">        return smoothedValues;</span>
    }

    public static void ProjectionReports(Semester outSemester, String SemName,ArrayList&lt;Semester&gt; semesterList) {

        // Detailed :: Steps up file path for Detailed Project Report CVS Sheet
<span class="nc" id="L198">        String filename = SemName + &quot;_DetailedProjectionReport.xls&quot;;</span>
<span class="nc" id="L199">        File file = new File(filename);</span>
<span class="nc bnc" id="L200" title="All 2 branches missed.">        if (file.exists()) {</span>
<span class="nc" id="L201">            System.out.println(filename + &quot;Already Exist&quot;);</span>
        }

        // Simple :: Sets up First Line of Consle output
<span class="nc" id="L205">        String[] data = { &quot;Course&quot;, &quot;Enrollment&quot;, &quot;Projected&quot;, &quot;Cap&quot; };</span>
<span class="nc" id="L206">        writeDataToCSV(data, filename);</span>
<span class="nc" id="L207">        writeDataToConsle(data, filename);</span>
<span class="nc" id="L208">        ArrayList&lt;Course&gt; tempCourseList = outSemester.getSnapshot(outSemester.getSnapshotListSize() - 1).getCourseList();</span>

        // Loops Through All the Courses avaiable in the given Semester
<span class="nc bnc" id="L211" title="All 2 branches missed.">        for (int i = 0; i &lt; tempCourseList.size(); i++) {</span>

            // Gathers All the needed data for a specific course across all the snapshots in
            // outSemester
<span class="nc" id="L215">            int[] enrollmentOverAllSnapshots = new int[outSemester.getSnapshotListSize()];</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">            for (int x = 0; x &lt; outSemester.getSnapshotListSize(); x++) {</span>
                // Gathers all total enrollment
               
<span class="nc bnc" id="L219" title="All 2 branches missed.">               if(outSemester.getSnapshot(x).getCourse(tempCourseList.get(i).getCRSE()) != null){</span>
<span class="nc" id="L220">                 enrollmentOverAllSnapshots[x] = outSemester.getSnapshot(x).getCourse(tempCourseList.get(i).getCRSE()).getTotalEnrolled();</span>
                }
            }

            // Uses collected data to find and calculated needed data
<span class="nc" id="L225">            int[] smoothedEnrollmentOverAllSnapshots = smoothCurve(enrollmentOverAllSnapshots);</span>
<span class="nc" id="L226">            int projected = smoothedEnrollmentOverAllSnapshots[outSemester.getSnapshotListSize() - 1];</span>
<span class="nc" id="L227">            Random r = new Random();</span>
<span class="nc" id="L228">            int randomNum = r.nextInt(10);</span>
<span class="nc bnc" id="L229" title="All 2 branches missed.">            if (tempCourseList.get(i).getOverallCap() != projected) {</span>
<span class="nc" id="L230">                int temp = projected += randomNum;</span>
<span class="nc bnc" id="L231" title="All 2 branches missed.">                if (temp &gt; projected) {</span>
<span class="nc bnc" id="L232" title="All 2 branches missed.">                    if (temp &gt; projected) {</span>
<span class="nc" id="L233">                        temp -= 1;</span>
                    }
<span class="nc" id="L235">                    projected = temp;</span>
                }

                // Outputs data line by line

                /// Simple :: formats the need data in an array of Strings and sends it to
                /// writeDataToConsle
                String needMoreSeats;

<span class="nc bnc" id="L244" title="All 2 branches missed.">                if(projected&gt;tempCourseList.get(i).getOverallCap())</span>
                {
<span class="nc" id="L246">                    needMoreSeats = &quot;*&quot;;</span>
                }
                else{
<span class="nc" id="L249">                    needMoreSeats = &quot; &quot;;</span>
                }
<span class="nc" id="L251">                data = new String[] { needMoreSeats + tempCourseList.get(i).getSubject() + tempCourseList.get(i).getCRSE(),</span>
<span class="nc" id="L252">                        String.valueOf(tempCourseList.get(i).getTotalEnrolled()),</span>
<span class="nc" id="L253">                        String.valueOf(projected),</span>
<span class="nc" id="L254">                        String.valueOf(tempCourseList.get(i).getOverallCap())</span>
                };
                
                try {
<span class="nc" id="L258">                    excelTemplate(tempCourseList,filename,semesterList);</span>
<span class="nc" id="L259">                } catch (IOException e) {</span>
<span class="nc" id="L260">                        System.err.println(&quot;Error:Excel Output Failed&quot;);</span>
<span class="nc" id="L261">                        System.exit(1);</span>
<span class="nc" id="L262">                }</span>
<span class="nc" id="L263">                writeDataToConsle(data, filename);</span>
            }
        }
<span class="nc" id="L266">        System.out.println(&quot;\n\nData has been written to &quot; + filename + &quot; successfully!&quot;);</span>
<span class="nc" id="L267">    }</span>

    // Prints Data to CSV sheet line by line
    public static void writeDataToCSV(String[] data, String filename) {
        try {
<span class="nc" id="L272">            FileWriter csvWriter = new FileWriter(filename, true);</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">            for (int i = 0; i &lt; data.length; i++) {</span>
<span class="nc" id="L274">                csvWriter.append(data[i]);</span>
<span class="nc bnc" id="L275" title="All 2 branches missed.">                if (i != data.length - 1) {</span>
<span class="nc" id="L276">                    csvWriter.append(&quot;,&quot;); // use a comma as the delimiter between columns</span>
                }
            }
<span class="nc" id="L279">            csvWriter.append(&quot;\n&quot;); // add a new line character to separate rows</span>
<span class="nc" id="L280">            csvWriter.flush();</span>
<span class="nc" id="L281">            csvWriter.close();</span>
<span class="nc" id="L282">        } catch (IOException e) {</span>
<span class="nc" id="L283">            e.printStackTrace();</span>
<span class="nc" id="L284">        }</span>
<span class="nc" id="L285">    }</span>

    // Prints Data to Consle Line by line
    public static void writeDataToConsle(String[] data, String filename) {
<span class="nc" id="L289">        int columnSpacing = 12;</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">        for (int i = 0; i &lt; data.length; i++) {</span>
<span class="nc" id="L291">            System.out.printf(&quot;%-&quot; + columnSpacing + &quot;s&quot;, data[i]);</span>
        }
<span class="nc" id="L293">        System.out.printf(&quot;\n&quot;);</span>
<span class="nc" id="L294">    }</span>

    public static Semester mergeSemesters(ArrayList&lt;Semester&gt; inSemesterList) {
<span class="nc" id="L297">        Semester outSemester = new Semester();</span>
<span class="nc bnc" id="L298" title="All 2 branches missed.">        for (int i = 0; i &lt; inSemesterList.size(); i++) {</span>
<span class="nc bnc" id="L299" title="All 2 branches missed.">            for (int x = 0; x &lt; inSemesterList.get(i).getSnapshotList().size(); x++) {</span>
<span class="nc" id="L300">                outSemester.addSnapshot(inSemesterList.get(i).getSnapshot(x));</span>
            }
        }
<span class="nc" id="L303">        return outSemester;</span>
    }

    public static void excelTemplate(ArrayList&lt;Course&gt; course, String excelOutput,ArrayList&lt;Semester&gt; semesterList) throws IOException {
<span class="nc" id="L307">        Workbook workbook = new HSSFWorkbook();</span>

<span class="nc bnc" id="L309" title="All 2 branches missed.">        for (int i = 0; i &lt; course.size(); i++) {</span>

<span class="nc" id="L311">            Sheet sheet = workbook.createSheet(course.get(i).getCourse());</span>
            // Create the header in the worksheet
            
<span class="nc" id="L314">            Row row = sheet.createRow(0);</span>
<span class="nc" id="L315">            Cell headerCell = row.createCell(1);</span>

<span class="nc" id="L317">            int numCells = 1;</span>
<span class="nc" id="L318">            int numSems = 0;</span>

<span class="nc bnc" id="L320" title="All 2 branches missed.">            for(numCells=0; numCells+1 &lt;= 2*semesterList.size(); numCells++){</span>
                // Create cells in the header and set their values
<span class="nc" id="L322">                headerCell = row.createCell(numCells); </span>
<span class="nc" id="L323">                headerCell.setCellValue(&quot;d historical&quot;);</span>

<span class="nc bnc" id="L325" title="All 2 branches missed.">                for(int g = 1; g &lt; semesterList.get(numSems).getSnapshotListSize(); g++){</span>
<span class="nc" id="L326">                    row = sheet.createRow(g);</span>
<span class="nc" id="L327">                    Cell data = row.createCell(numCells);</span>
<span class="nc" id="L328">                    data.setCellValue(g/semesterList.get(numSems).getSnapshotListSize());</span>
                }
<span class="nc" id="L330">                row=sheet.getRow(0);</span>
<span class="nc" id="L331">                numCells++;</span>

<span class="nc" id="L333">                headerCell = row.createCell(numCells); </span>
<span class="nc" id="L334">                headerCell.setCellValue(&quot;Previous Semester&quot;);</span>
<span class="nc" id="L335">                numCells++;</span>
<span class="nc bnc" id="L336" title="All 2 branches missed.">                for(int g = 1; g&lt;semesterList.get(numSems).getSnapshotListSize(); g++){</span>
<span class="nc" id="L337">                    row = sheet.createRow(i);</span>
<span class="nc" id="L338">                    Cell data = row.createCell(numCells);</span>
<span class="nc" id="L339">                    data.setCellValue(course.get(i).getTotalEnrolled());</span>
                }
<span class="nc" id="L341">                numSems++;</span>
            }
    //After Above is implemented this can change appropriately
<span class="nc" id="L344">            numCells =+ 1;</span>
<span class="nc" id="L345">            numSems = semesterList.size() - 1;</span>
<span class="nc" id="L346">            headerCell = row.createCell(numCells);</span>
<span class="nc" id="L347">            headerCell.setCellValue(&quot;d current&quot;);</span>
<span class="nc bnc" id="L348" title="All 2 branches missed.">            for(int g = 0; g&lt;semesterList.size(); g++){</span>
<span class="nc" id="L349">                row = sheet.createRow(g);</span>
<span class="nc" id="L350">                Cell data = row.createCell(numCells);</span>
<span class="nc" id="L351">                data.setCellValue(g/semesterList.get(numSems).getSnapshotListSize());</span>
            }

<span class="nc" id="L354">            numCells =+1;</span>
<span class="nc" id="L355">            headerCell = row.createCell(numCells);</span>
<span class="nc" id="L356">            headerCell.setCellValue(&quot;Current Semester&quot;);</span>
<span class="nc bnc" id="L357" title="All 2 branches missed.">            for(int g = 0; g&lt;semesterList.get(numSems).getSnapshotListSize(); g++){</span>
<span class="nc" id="L358">                row = sheet.createRow(i);</span>
<span class="nc" id="L359">                Cell data = row.createCell(numCells);</span>
<span class="nc" id="L360">                data.setCellValue(course.get(i).getTotalEnrolled());</span>
            }

<span class="nc" id="L363">            headerCell = row.createCell(4);</span>
<span class="nc" id="L364">            headerCell.setCellValue(&quot;d projected&quot;);</span>

<span class="nc" id="L366">            headerCell = row.createCell(5);</span>
<span class="nc" id="L367">            headerCell.setCellValue(&quot;Projected&quot;);</span>

<span class="nc" id="L369">            Row rowData = sheet.createRow(1);</span>
<span class="nc" id="L370">            Cell cellData = rowData.createCell(0);</span>
<span class="nc" id="L371">            cellData.setCellValue(.1);</span>
          
    // //After Above is implemented this can change appropriately
    //             headerCell = row.createCell(2);
    //             headerCell.setCellValue(); //d current Value

    //             headerCell = row.createCell(3);
    //             headerCell.setCellValue(); //current Semester enrolled

    //             headerCell = row.createCell(4);
    //             headerCell.setCellValue(); //d projected value

    //             headerCell = row.createCell(5);
    //             headerCell.setCellValue(); // Projected value

<span class="nc" id="L386"> FileOutputStream out = new FileOutputStream(new File(excelOutput));</span>
<span class="nc" id="L387">            workbook.write(out);</span>
<span class="nc" id="L388">            workbook.close();</span>
        }
<span class="nc" id="L390">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>